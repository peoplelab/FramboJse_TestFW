<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title></title>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript">

		/*  jQuery function is the entrance function that jQuery execute.
		*
		*   Below code means when the html document load ready, this is similar to window.onload() = function(){......};
		*
		*   You can also use $(document).ready(function(){......}), $ is an alias of jQuery.
		*
		*   You can even use $(function(){......}) to process document load ready event.
		* */
		jQuery(document).ready(function () {

			$("#click_button").click(function () {
				var username = $("#username").val();
                var password = $("#password").val();

                var data = "<?xml version=\"1.0\" encoding=\"utf-16\"?>\r\n<Response xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" ID=\"20200303082855863\">\r\n  <Result>\r\n    <Codice>0</Codice>\r\n    <Descrizione>xxxxxxxxxxx</Descrizione>\r\n  </Result>\r\n  <Data>\r\n    <AccessToken>ZnBz0Fk_3zfqy2phs3F-0eLNcwAx51N7Pn1Q-dqZtl1KiR-h9uD7gQ24xWAXDVQdlcYdGiI_U2wBlF-BcVz0IOxt6Urf4expta1_AS123XY9M-jJPVQAlcvS1LMUXwhsZTS8nRcHQO_89sgOMw5woSMNHOFGmKnkwVN78IcMT4XV-UMaaW6UkLWEsxn1M-FoHlPBq61MYF5x_fkJejWwFsfuzNe0nnZBpzyfB6bwCww0JXKtgNjIcSRWhnR3Ae8VR_lU1ktSPOwEWfB7B0Zm774HeoVqQhXdPcqqG-A4sFCuqhiBRUjrbqBNt7G2gTdeH7ioPwab4QiFbML6hStjrA</AccessToken>\r\n    <TokenType>bearer</TokenType>\r\n    <Expires>59</Expires>\r\n  </Data>\r\n</Response>";
                var response = onAjaxSuccess(data);
				/*var savedAjaxOptions = {
					type: "POST",
					url: "/api/login",
					data: '{data : "<?xml version=\'1.0\' encoding=\'utf-8\' ?><Request ID=\'20200303082855863\'><General><Token>undefined</Token></General><Data><Username>' + username + '</Username><Password>' + password + '</Password></Data></Request>"}',

					contentType: "application/json",
					headers: {

						'Authorization': "BASIC QzFBMDNCMTAtN0Q1OS00MDdBLUE5M0UtQjcxQUIxN0FEOEMyOjE3N0UzMjk1LTA2NTYtNDMxNy1CQzkxLUREMjcxQTE5QUNGRg=="
					},

					dataType: "json",
					success: function (response) {
						var _ans = onAjaxResponse(response);
						if (_ans.ResponseCode == 0) {
							onAjaxSuccess(_ans.RawData);
						} else {
							alert(_ans.ResponseMessage);
						} 
						console.log("ans: " + _ans);
					},
					error: function (jqXHR, textStatus, errorThrown, response) {
						var _ans = onAjaxResponse(response);
						alert("error");
						consoe.log(_ans);
						console.log(jqXHR, textStatus, errorThrown);
					},
					canRedirect: 1

				};
				$.ajax(savedAjaxOptions);*/
			});
			function onAjaxResponse(response) {

				var xmlDoc = $.parseXML(response.d);
				var data = $(xmlDoc);
				var responseCode = parseInt($(data).find("Response>Result>Codice").text());
				var responseMessage = decodeURIComponent($(data).find("Response>Result>Descrizione").text());
				return {
					ResponseCode: responseCode,
					ResponseMessage: responseMessage,
					RawData: response.d
				};
			}
			function onAjaxSuccess(data) {
				var parser = new DOMParser();
				var xmlDoc = parser.parseFromString(data, "text/xml");
				var _auth = xmlDoc.getElementsByTagName("AccessToken")[0].childNodes[0].nodeValue;
				__WACookie = { 'result': _auth };
				setCookie("FramboJSe_TestWAPars", JSON.stringify(__WACookie), 1);
				location.href = "/home/new_home";
			}

		});
		function setCookie(cname, cvalue, exdays) {
			var d = new Date();
			d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
			var expires = "expires=" + d.toUTCString();
			document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
		}

	</script>
</head>
<body>
	<h3>login</h3>
	<input type="text" id="username" name="username">
	<br><br>
	<input type="text" id="password" name="password">
	<br><br>
	<button id="click_button">
		login
	</button>
</body>
</html>